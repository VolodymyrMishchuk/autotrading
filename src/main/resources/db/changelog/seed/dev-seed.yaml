databaseChangeLog:
  # Увімкнути pgcrypto для bcrypt у Postgres
  - changeSet:
      id: dev-seed-ext-pgcrypto
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              CREATE EXTENSION IF NOT EXISTS pgcrypto;

  # USER (SUPER_ADMIN) з bcrypt паролем, який рахується на SQL боці
  - changeSet:
      id: dev-seed-user-superadmin
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO users (
                id, first_name, last_name, birth_day, phone_number, email,
                password, role, status, created_at, updated_at, token
              )
              VALUES (
                '11111111-1111-1111-1111-111111111111',
                'Test', 'Superadmin', '1990-01-01',
                '+380000000000', 'admin@autotrade.local',
                '{bcrypt}' || crypt('Admin123!', gen_salt('bf')),
                'SUPER_ADMIN', 'ACTIVE', now(), now(),
                'aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa'
              )
              ON CONFLICT (id) DO NOTHING;

  # ACCOUNT -> USER
  - changeSet:
      id: dev-seed-account
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO accounts (
                id, name, status, balance, created_at, updated_at, user_id
              )
              VALUES (
                '22222222-2222-2222-2222-222222222222',
                'Dev Spot Account', 'ACTIVE', 10000.00, now(), now(),
                '11111111-1111-1111-1111-111111111111'
              )
              ON CONFLICT (id) DO NOTHING;

  # CABINET -> USER, ACCOUNT
  - changeSet:
      id: dev-seed-cabinet
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO cabinets (
                id, name, meta_trade_token, status, created_at, updated_at, user_id, account_id
              )
              VALUES (
                '33333333-3333-3333-3333-333333333333',
                'Dev Cabinet', 'dev-mt-token', 'ACTIVE', now(), now(),
                '11111111-1111-1111-1111-111111111111',
                '22222222-2222-2222-2222-222222222222'
              )
              ON CONFLICT (id) DO NOTHING;

  # SOURCE -> ACCOUNT (id збігається з тим, що ти кидав у Kafka)
  - changeSet:
      id: dev-seed-source
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO sources (
                id, name, platform, status, token, chat_id, settings, created_at, updated_at, account_id
              )
              VALUES (
                'ace6bc1c-c94c-40c3-8146-c0bda8381863',
                'Telegram Channel DEV', 'TELEGRAM', 'ACTIVE',
                'dev-source-token-1', 123456,
                '{"parse_mode":"default"}'::jsonb, now(), now(),
                '22222222-2222-2222-2222-222222222222'
              )
              ON CONFLICT (id) DO NOTHING;

  # LINK CABINET <-> SOURCE
  - changeSet:
      id: dev-seed-cabinet-source
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO cabinet_sources (id, cabinet_id, source_id, status)
              VALUES (
                '44444444-4444-4444-4444-444444444444',
                '33333333-3333-3333-3333-333333333333',
                'ace6bc1c-c94c-40c3-8146-c0bda8381863',
                'ACTIVE'
              )
              ON CONFLICT (id) DO NOTHING;

  # EMAIL VERIFICATION TOKEN -> USER (помічений як підтверджений)
  - changeSet:
      id: dev-seed-email-token
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO email_verification_tokens (
                id, token, expires_at, confirmed_at, created_at, user_id
              )
              VALUES (
                '66666666-6666-6666-6666-666666666666',
                'verify-dev-token',
                now() + interval '1 day',
                now(), -- відразу підтверджений, щоб логін не блокувався
                now(),
                '11111111-1111-1111-1111-111111111111'
              )
              ON CONFLICT (id) DO NOTHING;

  # AUTH REFRESH TOKEN -> USER
  - changeSet:
      id: dev-seed-auth-token
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO auth_tokens (
                id, user_id, refresh_token, expiry_date, created_at
              )
              VALUES (
                '77777777-7777-7777-7777-777777777777',
                '11111111-1111-1111-1111-111111111111',
                'dev-refresh-token-aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',
                now() + interval '30 days',
                now()
              )
              ON CONFLICT (id) DO NOTHING;

  # SAMPLE TRANSACTION -> USER, ACCOUNT, CABINET, SOURCE
  - changeSet:
      id: dev-seed-transaction
      author: dev
      context: dev-seed
      changes:
        - sql:
            sql: |
              INSERT INTO transactions (
                id, symbol, amount, direction,
                opened_at, closed_at, balance_after, is_profitable, created_at,
                user_id, account_id, cabinet_id, source_id
              )
              VALUES (
                '55555555-5555-5555-5555-555555555555',
                'BTCUSDT', 1.0, 'BUY',
                now(), NULL, 10000.00, NULL, now(),
                '11111111-1111-1111-1111-111111111111',
                '22222222-2222-2222-2222-222222222222',
                '33333333-3333-3333-3333-333333333333',
                'ace6bc1c-c94c-40c3-8146-c0bda8381863'
              )
              ON CONFLICT (id) DO NOTHING;